# Maven - базови концепции

[Maven](https://maven.apache.org/) е най-използваният в Java света инструмент за изграждане на проекти (build tool). Изпозлва декларативен стил на описание на проектите в файл наречен pom.xml (от Project Object Model). pom.xml-а е разположен в основната папка на проекта. Подробно описание на структурата му може да се намери [тук](https://maven.apache.org/pom.html)

Maven се базира на четери основни концепции:
* Артефакти (Artifacts)
* Стандартни стъпки за изграждане на проекта (Build Life-cycle)
* Хранилища за артефакти (Repositories)
* управление на зависимости (Dependencies)

## Артефакти

Изхода от успешно изграден проект се нарича артефакт, това може да бъде библиотела или самостоятелно приложение (JAR), web модул (WAR) и т.н. Възможно е един проект да изгражда множество артефакти, например допълнителен артефакт с изходният код, друг с javadoc и т.н.

Артефактите се описват еднoзначно със следните характеристики:
* groupId - позволява да се групират няколко артефакта или да се гарантира допълнителна уникалност на артефакта. Използва се обърната нотация, както при пакетите в java, например bg.proxiad.courses;
* artefactId - кратко, но по-възможност описателно име на изходният продукт. Често съвпада с името на проекта, например web-programming-course;
* version - версията на артефакта. Обикновено се формира от три части major.minor.patch (1.0.1) за крайните версии или + SNAPSHOT (1.0.0-SNAPSHOT) за версиите в разработка. Повече детайли могат да бъдат прочетени [тук](http://maven.apache.org/guides/getting-started/index.html#What_is_a_SNAPSHOT_version)
* packaging - посочва вида на изходният файл. Например jar, war и т.н.

Описанието на един примерен артифакт изглежда така:
```xml
<groupId>bg.proxiad.courses</groupId>
<artifactId>web-programming-course</artifactId>
<version>1.0.0-SNAPSHOT</version>
```
## Стандартни стъпки (build lifecycle)

Повечето проекти, независимо на какъв език са написани и какъв инструмент за изграждане използват, споделят общ набор от стъпки за да се получи крайният резултат. Тези общи стъпки са идентифицирани и [заложени в Maven по подразбиране](https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html). Ето и някои от най-често използваните (пълен списък има [тук](https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Lifecycle_Reference)):

* compile - компилира изходният код на проекта
* test - стартира unit test-ове (ако има такива) които да валидират вече компилираният код
* package - взима компилираният код и други необходими ресурси и ги пакетира в зададеният формат, например WAR
* install - инсталира пакетираният артефакт в локалното хранилище (repository) за локална употреба от други проекти
* deploy - инсталира пакетираният артефакт в отдалечено преконфигуриано хранилище за употреба от дуги програмисти и проекти

Когато Maven се използва от командна линия се подава стъпката до която трябва да бъде изграден проекта. Примерни често използвани команди са:

```mvn test``` - компилира и изпълбява наличните unit test-ове   
```mvn install``` - компилира, тества, пакетира и инсталира в локалното хранилище

## Хранилища за артефакти (repositories)

Maven идва преконфигуриран с 2 хранилища:
* [централно (Maven Central Repository)](https://search.maven.org/) - разполага с огромна наличност от артефакти генерирани от проекти с отворен сорс или свободни за дистрибуция в бинарен формат. Достатъчно за 99% от нуждите на един средностатистически проект
* локално - по подразбиране е разположено в ```<потребителска папка>/.m2/repository``` и се използва да се съхраняват свалените от централното и други хранилища артефакти за нуждите на развойната среда , компилатора, Maven и т.н.

Допълнително могат да се конфигурират други [публични хранилища или частни/затворени вътрешни такива](https://maven.apache.org/guides/introduction/introduction-to-repositories.html).

## Управление на зависимости

Повечето проекти нормално използват вънщни библиотеки, било то за нуждите на компилацията, тестването или по време на изпълнението (run-time). Тези нужди се наричат в Maven зависимости (dependencies). Те се описват в pom.xml-a и изглеждат така:

```xml
    <project>
      ...
      <dependencies>
        <dependency>
          <groupId>org.apache.commons</groupId>
          <artifactId>commons-lang3</artifactId>
          <version>3.5</version>
        </dependency>
        ...
      </dependencies>
      ...
    </project>
```
Повече информация може да бъде намерена [тук](https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html)

Случва се един проект X да зависи от артефакт A, а той от своя страна да зависи от артефакт B (X -> A -> B). Такива зависимости се наричат транзитивни. Maven се грижи такива зависимости да бъдат задоволоявани автоматично, без да е необходимо да се добавят в ```pom.xml```-a изрично.